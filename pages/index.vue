<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useFetch } from '#app';
import AOS from 'aos';
import 'aos/dist/aos.css';

import messages from '@/public/langData.json';

const home: globalThis.Ref<HTMLDivElement | null> = ref(null);
const avatar = ref(null);
const avatarImg = ref(null);
const introList = ref(null);
const homeBlock = ref(null);
const showBlock = ref(false);

const scrollIcon = ref(null);
const circle = ref(0);
const lastPageYOffset = ref(0);

const isDesktopUp = ref(false);
onMounted(() => {
  AOS.init();

  showBlock.value = getShowBlock();

  isDesktopUp.value = window.innerWidth > 1023;
  window.addEventListener('scroll', (e) => {

    isDesktopUp.value = window.innerWidth > 1023;

    if (window.pageYOffset > lastPageYOffset.value) {
      circle.value += 1;
    } else {
      circle.value -= 1;
    }
    lastPageYOffset.value = window.pageYOffset;
    scrollIcon.value.style.transform = `rotate(${circle.value}deg)`;

    showBlock.value = getShowBlock();
    const headerBackground = document.querySelector('.header__background');
    
    if (isDesktopUp.value) {
      if (!showBlock.value) {
        home.value ? home.value.style.backgroundColor = '#F4F4F4' : null;
        headerBackground.style.backgroundColor = 'transparent';
        homeBlock.value.style.backgroundColor = '#F4F4F4';
      } else {
        home.value ? home.value.style.backgroundColor = 'transparent' : null;
        headerBackground.style.backgroundColor = '#ffffff';
        homeBlock.value.style.backgroundColor = '#111111';
      }
    }
  })
})

const { tm, locale } = useI18n({
  messages,
});

function getShowBlock() {
  return avatarImg.value.getBoundingClientRect().bottom - 350 <= introList.value.getBoundingClientRect().bottom;
}

interface BlogItem {
  title: string,
  image: string,
  desc: string,
  url: string,
}

const blogData: Ref<BlogItem[]> = ref([]);

async function getBlogData() {
  try {
    const { data, error } = await useFetch('https://guiblogs.com/api/posts.json');
    blogData.value = data.value;
  } catch (e) {
    console.log(e);
  }
}
getBlogData();
</script>

<template>
  <div ref="home" class="home">
    <div class="home__intro">
      <div ref="avatar" class="home__intro__avatar">
        <div ref="avatarImg" class="home__intro__avatar__img">
          <svg ref="scrollIcon" class="home__intro__avatar__scrollIcon" width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M90.4001 23.44L91.1201 26.88L93.3601 27.12L90.0001 11.76L87.1201 11.44L80.0801 25.52L82.3201 25.76L83.8401 22.64L90.4801 23.44H90.4001ZM88.1601 13.36H88.3201L90.0001 21.84L84.4001 21.12L88.0801 13.36H88.1601Z" fill="#111111"/>
            <path d="M108.88 33.6C109.76 33.68 110.48 33.6 111.12 33.28C111.76 32.96 112.24 32.4 112.64 31.68C113.12 30.72 113.28 29.84 112.96 29.04C112.64 28.16 111.92 27.36 110.8 26.64V26.48C111.68 26.72 112.32 26.88 112.96 26.88C113.52 26.88 114.08 26.72 114.48 26.4C114.88 26.08 115.2 25.76 115.52 25.2C115.84 24.64 116 24.08 116 23.52C116 22.96 115.84 22.4 115.6 21.92C115.36 21.44 114.96 20.96 114.4 20.48C113.84 20 113.2 19.6 112.48 19.2L107.76 16.64L100.72 29.68L105.92 32.48C107.04 33.12 108 33.44 108.88 33.6ZM108.64 19.12L111.36 20.56C111.76 20.8 112.16 21.04 112.56 21.28C112.96 21.52 113.2 21.84 113.44 22.16C113.68 22.48 113.76 22.8 113.84 23.2C113.84 23.6 113.84 24 113.6 24.4C113.36 24.8 113.12 25.12 112.72 25.28C112.32 25.44 112 25.52 111.6 25.52C111.2 25.52 110.72 25.36 110.24 25.2C109.76 25.04 109.28 24.8 108.8 24.56L106.4 23.28L108.64 19.12ZM105.68 24.64L108.24 26C108.64 26.24 109.04 26.48 109.36 26.72C109.76 26.96 110.08 27.2 110.32 27.52C110.56 27.84 110.8 28.08 110.96 28.4C111.12 28.72 111.2 29.04 111.2 29.44C111.2 29.76 111.04 30.16 110.88 30.56C110.64 30.96 110.4 31.28 110.08 31.44C109.76 31.6 109.44 31.68 109.04 31.68C108.64 31.68 108.32 31.6 107.92 31.44C107.52 31.28 107.2 31.12 106.8 30.96L103.2 29.04L105.6 24.64H105.68Z" fill="#111111"/>
            <path d="M121.04 45.28C121.76 46.08 122.48 46.72 123.28 47.12C124.08 47.52 124.96 47.68 125.76 47.76C126.64 47.76 127.52 47.6 128.4 47.2C129.28 46.8 130.16 46.24 131.12 45.52C132.08 44.72 132.8 43.92 133.36 43.04C133.92 42.16 134.24 41.28 134.4 40.48C134.56 39.6 134.4 38.72 134.24 37.92C134 37.12 133.52 36.32 132.88 35.52C132.08 34.56 131.12 33.84 130 33.52C128.88 33.12 127.76 33.12 126.48 33.36C125.2 33.6 123.92 34.4 122.64 35.52C121.76 36.24 121.04 37.04 120.56 37.84C120 38.64 119.68 39.52 119.52 40.32C119.36 41.12 119.44 42.08 119.68 42.88C119.92 43.68 120.4 44.56 121.12 45.36L121.04 45.28ZM122.08 39.12C122.48 38.4 123.12 37.68 124 36.96C124.96 36.16 125.84 35.6 126.64 35.36C127.44 35.12 128.08 34.96 128.72 35.12C129.36 35.2 129.84 35.36 130.32 35.68C130.8 36 131.12 36.24 131.44 36.64C131.92 37.28 132.24 37.92 132.4 38.72C132.56 39.52 132.4 40.32 131.92 41.2C131.44 42.08 130.72 42.96 129.68 43.92C128.8 44.72 127.92 45.2 127.2 45.52C126.48 45.84 125.76 45.92 125.12 45.84C124.48 45.84 124 45.6 123.52 45.28C123.04 44.96 122.72 44.64 122.4 44.32C122 43.92 121.76 43.44 121.52 42.88C121.28 42.4 121.28 41.84 121.28 41.2C121.28 40.56 121.6 39.92 122 39.2L122.08 39.12Z" fill="#111111"/>
            <path d="M131.68 57.92C131.36 58.4 131.12 58.88 130.96 59.44C130.8 60 130.72 60.64 130.72 61.28C130.72 61.92 130.88 62.64 131.12 63.36C131.44 64.24 131.84 65.04 132.32 65.68C132.8 66.32 133.36 66.8 134 67.12C134.64 67.44 135.36 67.68 136.16 67.68C136.96 67.68 137.84 67.6 138.72 67.28L147.44 64.48L146.8 62.48L138.16 65.28C137.44 65.52 136.72 65.6 136 65.52C135.36 65.52 134.72 65.2 134.16 64.8C133.6 64.4 133.2 63.68 132.88 62.72C132.56 61.84 132.56 61.04 132.72 60.4C132.88 59.76 133.2 59.2 133.76 58.72C134.24 58.24 134.88 57.92 135.68 57.68L144.32 54.88L143.68 52.88L134.96 55.68C134.24 55.92 133.6 56.24 133.04 56.56C132.48 56.88 132.08 57.28 131.68 57.76V57.92Z" fill="#111111"/>
            <path d="M148.8 81.84L148.96 77.44L147.2 77.36L147.04 81.76L134 81.28L133.92 83.28L146.96 83.84L146.72 88.32L148.56 88.4L148.8 82.48V81.84Z" fill="#111111"/>
            <path d="M141.84 96.72L138 98.64L136.08 94.72L134.48 95.52L136.4 99.44L132.48 101.36L133.28 102.96L137.2 101.04L139.04 104.96L140.64 104.16L138.72 100.24L142.64 98.32L141.84 96.72Z" fill="#111111"/>
            <path d="M125.36 109.68L127.28 112.56L123.12 117.84L119.84 116.72L118.48 118.48L133.44 123.44L135.2 121.12L126.72 107.92L125.36 109.68ZM132.88 121.28L124.8 118.4L128.24 114L133.04 121.12V121.28H132.88Z" fill="#111111"/>
            <path d="M107.44 126.56C106.32 127.2 105.52 127.92 105.04 128.56C104.48 129.2 104.24 129.92 104.16 130.64C104.16 131.36 104.32 132.08 104.72 132.8C105.28 133.68 106 134.24 106.88 134.4C107.76 134.56 108.8 134.4 110.08 133.76V133.92C109.6 134.4 109.12 134.96 108.8 135.52C108.48 136.08 108.4 136.56 108.4 137.04C108.4 137.52 108.56 138 108.88 138.48C109.2 139.04 109.6 139.44 110.08 139.76C110.56 140.08 111.04 140.24 111.6 140.24C112.16 140.24 112.8 140.16 113.44 139.92C114.08 139.68 114.8 139.36 115.52 138.96L120.16 136.16L112.48 123.44L107.44 126.48V126.56ZM117.52 135.68L114.88 137.28C114.48 137.52 114.08 137.76 113.6 137.92C113.2 138.08 112.8 138.24 112.4 138.24C112 138.24 111.68 138.24 111.28 138.08C110.96 137.92 110.64 137.68 110.4 137.28C110.16 136.88 110.08 136.48 110.08 136.08C110.08 135.68 110.24 135.36 110.48 134.96C110.72 134.64 111.04 134.24 111.44 133.92C111.84 133.6 112.24 133.28 112.72 133.04L115.04 131.6L117.52 135.68ZM111.76 131.84C111.36 132.08 110.96 132.32 110.56 132.48C110.16 132.64 109.76 132.8 109.36 132.88C108.96 132.96 108.64 132.96 108.24 132.96C107.84 132.96 107.52 132.8 107.28 132.64C106.96 132.48 106.72 132.16 106.48 131.84C106.24 131.44 106.08 131.04 106.08 130.72C106.08 130.4 106.16 130 106.4 129.68C106.64 129.36 106.88 129.04 107.12 128.8C107.44 128.56 107.76 128.32 108.16 128.08L111.6 126L114.24 130.32L111.76 131.84Z" fill="#111111"/>
            <path d="M95.6001 136.48C95.2001 135.6 94.6401 134.88 93.9201 134.32C93.2001 133.76 92.4801 133.36 91.6001 133.12C90.7201 132.88 89.7601 132.88 88.7201 133.12C87.6801 133.28 86.8001 133.6 86.0001 134.08C85.2801 134.56 84.6401 135.2 84.1601 135.92C83.6801 136.64 83.4401 137.52 83.2801 138.48C83.1201 139.44 83.2001 140.48 83.3601 141.68C83.6001 142.88 83.9201 144 84.3201 144.88C84.8001 145.76 85.3601 146.48 86.0001 147.04C86.7201 147.6 87.4401 148 88.3201 148.16C89.1201 148.4 90.0801 148.4 91.0401 148.16C92.3201 147.92 93.3601 147.44 94.2401 146.72C95.1201 146 95.7601 145.04 96.1601 143.76C96.5601 142.56 96.5601 141.04 96.3201 139.36C96.1601 138.24 95.8401 137.2 95.3601 136.32L95.6001 136.48ZM94.4801 142.96C94.3201 143.76 94.0001 144.4 93.6801 144.88C93.2801 145.36 92.8801 145.76 92.4001 146C91.9201 146.24 91.4401 146.4 91.0401 146.48C90.2401 146.64 89.5201 146.48 88.7201 146.24C88.0001 145.92 87.3601 145.44 86.8001 144.56C86.2401 143.76 85.8401 142.64 85.6801 141.2C85.5201 140 85.4401 139.04 85.6001 138.24C85.7601 137.44 86.0001 136.8 86.4001 136.32C86.8001 135.84 87.2001 135.44 87.6801 135.28C88.1601 135.12 88.6401 134.88 89.1201 134.8C89.6801 134.72 90.2401 134.72 90.8001 134.8C91.3601 134.88 91.8401 135.12 92.3201 135.44C92.8001 135.76 93.2801 136.32 93.6001 137.04C93.9201 137.76 94.3201 138.64 94.4801 139.76C94.7201 141.04 94.7201 142.08 94.4801 142.88V142.96Z" fill="#111111"/>
            <path d="M71.5199 134.32C71.1199 133.92 70.6399 133.52 70.0799 133.2C69.5199 132.88 68.7999 132.64 68.0799 132.48C67.1199 132.24 66.3199 132.24 65.5199 132.32C64.7199 132.4 63.9999 132.64 63.4399 133.04C62.7999 133.44 62.3199 133.92 61.8399 134.56C61.4399 135.2 61.1199 136 60.8799 136.96L58.8799 145.92L60.8799 146.4L62.8799 137.52C63.0399 136.8 63.3599 136.08 63.7599 135.52C64.1599 134.96 64.6399 134.56 65.2799 134.32C65.9199 134.08 66.7199 134.08 67.7599 134.32C68.7199 134.56 69.3599 134.88 69.8399 135.36C70.3199 135.84 70.6399 136.4 70.7999 137.12C70.9599 137.76 70.8799 138.48 70.7999 139.28L68.7999 148.16L70.7999 148.64L72.7999 139.68C72.9599 138.96 73.0399 138.24 73.0399 137.6C73.0399 136.96 72.8799 136.4 72.6399 135.84C72.3999 135.28 72.0799 134.8 71.6799 134.4L71.5199 134.32Z" fill="#111111"/>
            <path d="M49.5199 124.72L42.3199 135.68L38.6399 133.2L37.6799 134.72L41.3599 137.12L43.1199 138.24L46.7999 140.72L47.7599 139.2L44.0799 136.8L51.1999 125.84L49.5199 124.72Z" fill="#111111"/>
            <path d="M38.5601 120.72L38.7201 118.96L34.3201 118.64L34.7201 114.24L32.8801 114.08L32.5601 118.48L28.2401 118.08L28.0801 119.84L32.4801 120.24L32.0801 124.56L33.9201 124.72L34.2401 120.4L38.5601 120.72Z" fill="#111111"/>
            <path d="M31.2 103.92L27.76 104.08L25.28 97.84L27.92 95.6L27.12 93.52L15.28 103.84L16.32 106.56L32 106L31.2 103.92ZM17.36 104.48L23.92 98.96L26 104.16L17.44 104.64V104.48H17.36Z" fill="#111111"/>
            <path d="M25.84 79.92C25.84 78.64 25.68 77.6 25.36 76.8C25.04 76 24.56 75.44 24 75.04C23.44 74.64 22.72 74.48 21.84 74.48C20.8 74.48 20 74.8 19.36 75.52C18.72 76.16 18.4 77.2 18.32 78.56H18.08C17.92 77.76 17.76 77.12 17.44 76.56C17.12 76.08 16.72 75.68 16.32 75.44C15.84 75.2 15.36 75.12 14.8 75.12C14.16 75.12 13.6 75.28 13.12 75.52C12.64 75.76 12.24 76.16 11.92 76.64C11.6 77.12 11.36 77.68 11.28 78.4C11.12 79.12 11.04 79.84 11.12 80.72V86.08C11.2 86.08 26 85.84 26 85.84V79.92H25.84ZM12.72 84.08V80.96C12.72 80.48 12.72 80 12.72 79.6C12.72 79.12 12.88 78.72 13.04 78.4C13.2 78.08 13.44 77.76 13.76 77.52C14.08 77.28 14.48 77.2 14.96 77.2C15.44 77.2 15.84 77.28 16.16 77.52C16.48 77.76 16.72 78 16.88 78.4C17.04 78.8 17.2 79.2 17.28 79.68C17.36 80.16 17.44 80.64 17.44 81.2V83.92H12.72V84.08ZM18.96 84V81.12C18.96 80.64 18.96 80.24 18.96 79.76C18.96 79.28 19.04 78.88 19.2 78.56C19.36 78.16 19.52 77.84 19.68 77.52C19.84 77.2 20.16 76.96 20.48 76.8C20.8 76.64 21.2 76.56 21.6 76.56C22.08 76.56 22.48 76.56 22.8 76.8C23.12 76.96 23.36 77.2 23.52 77.6C23.68 77.92 23.84 78.32 23.92 78.72C24 79.12 24 79.52 24.08 79.92V84L19.12 84.08L18.96 84Z" fill="#111111"/>
            <path d="M16.5601 61.52C17.4401 62.48 18.6401 63.28 20.2401 63.92C21.2801 64.32 22.3201 64.56 23.2801 64.64C24.2401 64.64 25.1201 64.64 26.0001 64.32C26.8001 64.08 27.6001 63.6 28.1601 62.96C28.8001 62.32 29.2801 61.52 29.6801 60.56C30.0801 59.6 30.2401 58.64 30.2401 57.76C30.2401 56.88 30.0001 56 29.6001 55.28C29.2001 54.48 28.6401 53.84 27.8401 53.2C27.0401 52.56 26.1601 52.08 25.0401 51.68C23.9201 51.2 22.8001 50.96 21.7601 50.88C20.7201 50.88 19.8401 50.88 18.9601 51.2C18.0801 51.52 17.4401 52 16.8001 52.56C16.1601 53.2 15.6801 53.92 15.3601 54.88C14.8801 56.08 14.7201 57.2 14.9601 58.4C15.1201 59.52 15.6801 60.56 16.5601 61.52ZM17.1201 55.6C17.4401 54.88 17.8401 54.24 18.4801 53.76C19.1201 53.28 19.9201 53.04 20.8801 52.96C21.8401 52.96 23.0401 53.12 24.3201 53.68C25.4401 54.08 26.3201 54.56 26.8801 55.12C27.5201 55.68 27.9201 56.24 28.1601 56.8C28.4001 57.36 28.4801 57.92 28.4001 58.48C28.3201 59.04 28.2401 59.52 28.0801 59.92C27.8401 60.48 27.6001 60.96 27.2801 61.36C26.9601 61.76 26.4801 62.08 25.9201 62.32C25.3601 62.56 24.6401 62.64 23.8401 62.64C23.0401 62.64 22.0801 62.4 21.0401 62C19.8401 61.52 18.9601 61.04 18.3201 60.48C17.6801 59.92 17.2801 59.36 17.0401 58.8C16.8001 58.24 16.7201 57.68 16.8001 57.12C16.8001 56.56 16.9601 56.08 17.1201 55.68V55.6Z" fill="#111111"/>
            <path d="M34.0001 44.56C34.5601 44.88 35.1201 45.04 35.6801 45.12C36.2401 45.12 36.8001 45.12 37.4401 45.12C38.0001 44.96 38.6401 44.8 39.2001 44.4C39.7601 44.08 40.3201 43.6 40.8801 43.04C41.5201 42.32 42.0001 41.6 42.3201 40.88C42.6401 40.16 42.8001 39.44 42.8001 38.72C42.8001 38 42.6401 37.28 42.2401 36.56C41.9201 35.84 41.3601 35.12 40.6401 34.48L34.0001 28.16L32.5601 29.68L39.1201 35.92C39.6801 36.48 40.0801 37.04 40.4001 37.68C40.6401 38.32 40.7201 38.96 40.6401 39.6C40.4801 40.24 40.0801 40.96 39.4401 41.76C38.8001 42.48 38.1601 42.88 37.4401 43.04C36.8001 43.2 36.0801 43.2 35.4401 42.96C34.8001 42.72 34.1601 42.32 33.6001 41.76L27.0401 35.52L25.6001 37.04L32.2401 43.36C32.8001 43.84 33.3601 44.32 33.9201 44.64L34.0001 44.56Z" fill="#111111"/>
            <path d="M55.1999 17.36L54.3999 15.76L50.4799 17.68L49.3599 18.24L44.6399 20.56L45.4399 22.16L49.3599 20.24L55.1199 31.92L56.9599 30.96L51.1999 19.28L55.1999 17.36Z" fill="#111111"/>
            <path d="M73.6 16.16L72.08 15.12L69.6 18.64L66 16.08L64.96 17.6L68.56 20.08L66 23.6L67.44 24.64L70 21.12L73.52 23.6L74.56 22.16L71.04 19.68L73.6 16.16Z" fill="#111111"/>
          </svg>
          <svg class="home__intro__avatar__scrollIcon" width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M96.0312 80L80 96.0312L63.9688 80L66.875 77.1875L78.0312 88.3438V63.9688H81.9688V88.3438L93.2188 77.1875L96.0312 80Z" fill="#111111"/>
          </svg>
        </div>
      </div>
      <div ref="introList" class="home__intro__list">
        <JobTitleCard
          :name="tm('name')"
          :list="tm('jobTitleList')"
        />
        <listCard
          v-for="item in tm('listCard')"
          :key="item.title"
          :title="item.title"
          :list="item.list"
        />
      </div>
    </div>
    <div ref="homeBlock" class="home__block">
      <div class="home__container">
        <div id="blog" class="home__block__layout" data-aos="fade-up" data-aos-duration="800">
          <TitleButton title="Blog" />
          <BlogCardList :list="blogData" class="home__blog" />
        </div>
      </div>
    </div>
  </div>
</template>

<style lang="scss" scoped>
  .home {
    &__container {
      width: 90%;
      margin: auto;
    }

    &__intro {
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 30px auto;
      
      @include desktop-up() {
        width: 1100px;
        flex-direction: row;
        justify-content: space-between;
        margin: 72px auto 216px;
      }

      &__avatar {
        &__img {
          width: 210px;
          height: 227px;
          background-image: url('/gui_avatar.png');
          background-size: cover;
          max-width: 100%;
          margin-top: 18px;
          transition: opacity .3s;
          margin-bottom: 50px;
          
          @include desktop-up() {
            width: 420px;
            height: 453px;
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            display: block;
            margin-bottom: 0;
          }
        }

        &__scrollIcon {
          display: none;
          
          @include desktop-up() {
            display: block;
            position: fixed;
            left: 0px;
            bottom: -30px;
            z-index: 2;
            width: 120px;
            height: 120px;
          }
        }
      }

      &__list {
        width: 80%;
        display: flex;
        flex-direction: column;
        gap: 32px;

        @include desktop-up() {
          width: 50%;
        }
      }
    }

    &__block {
      position: relative;
      z-index: 3;
      background-color: #111111;
      padding: 72px 0 36px;
      margin-bottom: 36px;
      transition: background-color .8s;

      &__layout {
        display: flex;
        flex-direction: column;
        align-items: start;
        gap: 24px;
        width: 1100px;
        max-width: 100%;
        margin: auto;

        @include desktop-up() {
          flex-direction: row;
          justify-content: space-between;
          gap: 72px;
        }
      }
    }

    &__blog {
      @include desktop-up() {
        margin-bottom: 100px;
      }
    }
  }
</style>